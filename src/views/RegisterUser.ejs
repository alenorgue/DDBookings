<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register User</title>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css">
</head>

<body>
    <main class="container">
        <h1>Register User</h1>
        <form action="/api/users/register" method="POST" enctype="multipart/form-data">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required minlength="2" maxlength="100">

            <label for="surName">Surname</label>
            <input type="text" id="surName" name="surName" required minlength="2" maxlength="100">

            <label for="email">Email</label>
            <input type="email" id="email" name="email" required pattern="^[^@\s]+@[^@\s]+\.[^@\s]+$">

            <label for="password">Password</label>
            <input type="password" id="password" name="password" required minlength="8"
                pattern="^(?=.[a-z])(?=.[A-Z])(?=.\d)(?=.[!@#$%^&*()_+-={}[]:;?,./]).{8,}$"
                placeholder="Min 8 chars, 1 mayúscula, 1 minúscula, 1 número y 1 símbolo">

            <label for="role">Role</label>
            <select id="role" name="role" required>
                <option value="guest">Guest</option>
                <option value="host">Host</option>
            </select>

            <label for="profilePicture">Profile Picture</label>
            <input type="file" id="profilePicture" name="profilePicture" accept="image/*">
            <span style="font-size:0.9em;">Puedes subir una imagen o dejar vacío para no añadir foto.</span>

            <label for="bio">Bio</label>
            <textarea id="bio" name="bio" maxlength="500"></textarea>

            <label for="phoneNumber">Phone Number</label>
            <input type="text" id="phoneNumber" name="phoneNumber" pattern="^[0-9+\-() ]{7,20}$">

            <label for="country">Country</label>
            <input type="text" id="country" name="country">

            <label for="language">Language</label>
            <select id="language" name="language">
                <option value="en">English</option>
                <option value="es">Castellano</option>
                <option value="cat">Catala</option>
            </select>
            <button type="submit">Register</button>
        </form>
    </main>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        const name = form.name;
        const surName = form.surName;
        const email = form.email;
        const password = form.password;
        const role = form.role;
        const phone = form.phoneNumber;
        const country = form.country;
        const language = form.language;
        const bio = form.bio;
        const errorBox = document.createElement('div');
        errorBox.style.color = '#c00';
        errorBox.style.marginBottom = '1em';
        form.prepend(errorBox);

        function showError(msg) {
          errorBox.textContent = msg;
        }
        function clearError() {
          errorBox.textContent = '';
        }

        form.addEventListener('submit', function (e) {
          clearError();
          // Nombre y apellido
          if (name.value.length < 2 || name.value.length > 100) {
            showError('El nombre debe tener entre 2 y 100 caracteres.');
            e.preventDefault(); return;
          }
          if (surName.value.length < 2 || surName.value.length > 100) {
            showError('El apellido debe tener entre 2 y 100 caracteres.');
            e.preventDefault(); return;
          }
          // Email
          if (!/^\S+@\S+\.\S+$/.test(email.value)) {
            showError('Introduce un email válido.');
            e.preventDefault(); return;
          }
          // Password
          if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-={}\[\]:;?,./]).{8,}$/.test(password.value)) {
            showError('La contraseña debe tener al menos 8 caracteres, una mayúscula, una minúscula, un número y un símbolo.');
            e.preventDefault(); return;
          }
          // Rol
          if (!role.value || (role.value !== 'guest' && role.value !== 'host')) {
            showError('Selecciona un rol válido.');
            e.preventDefault(); return;
          }
          // Teléfono (opcional)
          if (phone.value && !/^[0-9+\-() ]{7,20}$/.test(phone.value)) {
            showError('Introduce un teléfono válido.');
            e.preventDefault(); return;
          }
          // País (opcional)
          if (country.value && (country.value.length < 2 || country.value.length > 100)) {
            showError('El país debe tener entre 2 y 100 caracteres.');
            e.preventDefault(); return;
          }
          // Idioma
          if (!['en','es','cat'].includes(language.value)) {
            showError('Selecciona un idioma válido.');
            e.preventDefault(); return;
          }
          // Bio (opcional)
          if (bio.value && bio.value.length > 500) {
            showError('La biografía no puede superar los 500 caracteres.');
            e.preventDefault(); return;
          }
        });
      });
    </script>
</body>

</html>