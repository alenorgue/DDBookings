<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalles de la Reserva</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">
  <style>
    body {
      background: url('/img/blog/blog-hero-1.webp') center center/cover no-repeat fixed;
      min-height: 100vh;
      position: relative;
    }
    .booking-details-card {
      background: rgba(255,255,255,0.97);
      border-radius: 1.2rem;
      box-shadow: 0 2px 16px rgba(0,0,0,0.08);
      padding: 2.2rem 2rem 2rem 2rem;
      max-width: 600px;
      margin: 2.5rem auto 2rem auto;
      position: relative;
    }
    .booking-details-card h2, .booking-details-card h3 {
      color: #232b3a;
      font-weight: 600;
    }
    .booking-details-card img {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      margin-bottom: 1.2rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.10);
    }
    .booking-details-card ul {
      padding-left: 1.2em;
      font-size: 1.05em;
    }
    .actions {
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .actions .btn {
      font-size: 0.95em;
      border-radius: 0.5em;
      padding: 0.35em 1.2em;
      min-width: 120px;
    }
    .btn-cancel {
      border: 1.5px solid #dc3545;
      color: #dc3545;
      background: #fff;
      transition: background 0.2s, color 0.2s;
    }
    .btn-cancel:hover {
      background: #dc3545;
      color: #fff;
    }
    .btn-contact {
      border: 1.5px solid #0d6efd;
      color: #0d6efd;
      background: #fff;
      transition: background 0.2s, color 0.2s;
    }
    .btn-contact:hover {
      background: #0d6efd;
      color: #fff;
    }
    .btn-back {
      border: 1.5px solid #6c757d;
      color: #6c757d;
      background: #fff;
      transition: background 0.2s, color 0.2s;
    }
    .btn-back:hover {
      background: #6c757d;
      color: #fff;
    }
    .details-video-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }
    .details-video-bg video {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      min-width: 100vw;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div class="dashboard-bg-overlay"></div>
    <div class="details-video-bg" aria-hidden="true" style="position:fixed;top:0;left:-5vw;width:105vw;height:100vh;z-index:-1;overflow:hidden;pointer-events:none;">
      <video autoplay muted loop playsinline tabindex="-1" style="width:120vw;height:120vh;object-fit:cover;min-width:104vw;min-height:100vh;opacity:0.55;">
        <source src="/img/details-view.mp4" type="video/mp4">
        Tu navegador no soporta el video de fondo.
      </video>
    </div>
  <%- include('partials/navbar', { user: typeof user !== 'undefined' ? user : null }) %>
  <main>
    <div class="booking-details-card fade-in">
      <h2 class="mb-3"><i class="fa-solid fa-file-invoice me-2"></i>Detalles de la Reserva</h2>
      <section>
        <h3 class="mb-2">Alojamiento reservado</h3>
        <img src="<%= accommodation.mainPhoto %>" alt="Foto principal">
        <p><strong>Título:</strong> <%= accommodation.title %></p>
        <p><strong>Ciudad:</strong> <%= accommodation.location.city %></p>
        <p><strong>Precio por noche:</strong> €<%= accommodation.pricePerNight %></p>
      </section>
      <section class="mt-4">
        <h3 class="mb-2">Datos de la Reserva</h3>
        <ul>
          <li><strong>Entrada:</strong> <%= booking.startDate.toLocaleDateString() %></li>
          <li><strong>Salida:</strong> <%= booking.endDate.toLocaleDateString() %></li>
          <li><strong>Personas:</strong> <%= booking.guests %></li>
          <li><strong>Estado:</strong> <%= booking.status %></li>
        </ul>
      </section>
      <section class="mt-4">
        <h3 class="mb-2">Datos del Huésped</h3>
        <ul>
          <li><strong>Nombre:</strong> <%= guest.name %> <%= guest.surName %></li>
          <li><strong>Email:</strong> <%= guest.email %></li>
          <li><strong>Teléfono:</strong> <%= guest.phoneNumber %></li>
        </ul>
      </section>
      <section class="mt-4">
        <h3 class="mb-2">Datos del Anfitrión</h3>
        <ul>
          <li><strong>Nombre:</strong> <%= host.name %> <%= host.surName %></li>
          <li><strong>Email:</strong> <%= host.email %></li>
          <li><strong>Teléfono:</strong> <%= host.phoneNumber %></li>
        </ul>
      </section>
      <div class="actions mt-4">
        <% if (booking.status !== 'cancelled') { %>
          <form action="/api/bookings/<%= booking.id %>/cancel" method="POST" onsubmit="return confirm('¿Estás seguro de que deseas cancelar esta reserva?');">
            <button type="submit" class="btn btn-cancel"><i class="fa-solid fa-ban me-1"></i>Cancelar reserva</button>
          </form>
        <% } else { %>
          <p class="text-danger"><strong>Reserva cancelada</strong></p>
        <% } %>
        <a href="mailto:host@example.com" class="btn btn-contact"><i class="fa-solid fa-envelope me-1"></i>Contactar anfitrión</a>
    
      </div>
      <a href="/dashboard/<%= booking.guestId %>" class="btn btn-back mt-4"><i class="fa-solid fa-arrow-left me-1"></i>Volver al dashboard</a>
    </div>
  </main>
  <%- include('partials/footer') %>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const fadeEls = document.querySelectorAll('.fade-in');
      if ('IntersectionObserver' in window) {
        const observer = new window.IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.15 });
        fadeEls.forEach(el => observer.observe(el));
      } else {
        fadeEls.forEach(el => el.classList.add('visible'));
      }
    });
  </script>
</body>
</html>
